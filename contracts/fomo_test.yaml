name: rover_diff_drive
version: 1


robot_type: rover
rate_hz: 10.0 
max_duration_s: 120.0

metadata:
  task:
    type: constant
    value: rover_diff_drive

observations:

  - key: observation.image.main
    topic: /camera/color/foxglove
    type: foxglove_msgs/msg/CompressedVideo
    align: {strategy: closest, stamp: foxglove, tol_ms: 0}
    qos: {reliability: best_effort, history: keep_last, depth: 10}

  - key: observation.image.left
    topic: /video_mapping/left/foxglove
    type: foxglove_msgs/msg/CompressedVideo
    align: {strategy: closest, stamp: foxglove, tol_ms: 0}
    qos: {reliability: best_effort, history: keep_last, depth: 10}

  - key: observation.image.right
    topic: /video_mapping/right/foxglove
    type: foxglove_msgs/msg/CompressedVideo
    align: {strategy: closest, stamp: foxglove, tol_ms: 0}
    qos: {reliability: best_effort, history: keep_last, depth: 10}

  - key: observation.image.rear
    topic: /video_mapping/rear/foxglove
    type: foxglove_msgs/msg/CompressedVideo
    align: {strategy: closest, stamp: foxglove, tol_ms: 0}
    qos: {reliability: best_effort, history: keep_last, depth: 10}

  - key: observation.state
    topic: /imu/data_abs_heading
    type: sensor_msgs/msg/Imu
    selector:
      names: [
        orientation.x, orientation.y, orientation.z, orientation.w,
        angular_velocity.x, angular_velocity.y, angular_velocity.z,
        linear_acceleration.x, linear_acceleration.y, linear_acceleration.z
      ]
    align: {strategy: hold, stamp: header, tol_ms: 100}
    qos: {reliability: best_effort, history: keep_last, depth: 50}

  - key: observation.state
    topic: /odometry/local
    type: nav_msgs/msg/Odometry 
    selector:
      names: [
        pose.pose.position.x, pose.pose.position.y, pose.pose.position.z,
        pose.pose.orientation.x, pose.pose.orientation.y, pose.pose.orientation.z, pose.pose.orientation.w,
        twist.twist.linear.x, twist.twist.angular.z
      ]
    align: {strategy: closest, stamp: header, tol_ms: 150}
    qos: {reliability: best_effort, history: keep_last, depth: 50}


actions:
  - key: action
    publish:
      topic: /motion_control/speed_controller/output_cmd  
      type: geometry_msgs/msg/TwistStamped
      layout: flat
      qos: {reliability: best_effort, history: keep_last, depth: 10}
      strategy:
        mode: nearest  # 'fifo' | 'nearest' - nearest selects action closest to current time
        tolerance_ms: 500  
    selector:
      names: [twist.linear.x, twist.angular.z]
      #names: [twist.linear.x, twist.linear.y, twist.linear.z, twist.angular.x, twist.angular.y, twist.angular.z] 
    from_tensor:
      clamp: [-2.0, 2.0]
    safety_behavior: zeros

recording:
  storage: mcap
